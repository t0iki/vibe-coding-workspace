# RUNECLICKER 開発メモ

## 🎮 現在の実装状況 (2024/08/17)

### ✅ 完了した機能

#### コア機能
- **React + TypeScript環境構築**
  - Vite使用、高速なHMR
  - ディレクトリ構造: domain/game/core/ui/componentsで整理
  - 関数型プログラミングアプローチ（クラス未使用）

#### ゲームシステム
- **基本戦闘システム**
  - SVGベースの描画（PixiJS未使用、軽量化重視）
  - プレイヤー（固定位置）と敵のスポーン
  - 自動攻撃（デバッグ用: 0.5秒ごと）
  
- **レベル/経験値システム**
  - デバッグ調整済み:
    - 経験値5倍獲得
    - 必要経験値: 50 + レベル×20（大幅削減）
    - レベルアップで2パッシブポイント獲得
  
- **パッシブツリー**
  - 3クラス実装: STR（物理）、DEX（クリティカル）、INT（魔法）
  - 各系統に独自のパスとコーナーストーン
  - ズーム/パン対応のUI
  - 約40ノード実装済み

- **ルーン/リンクシステム**
  - アクティブルーン: 光束ビーム、連鎖雷弾など
  - サポートルーン（リンク）: 最大3つ、タグ互換性チェック
  - DPS計算: README.mdの数式準拠（More効果のディミニッシング）
  - JSONからのデータ読み込み

### 🚧 進行中/未実装

#### 優先度: 高
- **基本QoL機能**
  - [ ] 長押し攻撃
  - [ ] オートクリック（解放式）
  - [ ] 自動拾い
  
- **保存システム**
  - [ ] IndexedDB実装
  - [ ] オートセーブ（1分間隔）
  - [ ] バージョン管理/マイグレーション

#### 優先度: 中
- **マップ/ステージシステム**
  - [ ] T1-T20のマップ実装
  - [ ] ボス敵
  - [ ] 報酬システム（通貨/アイテム）
  
- **データ駆動化の完全移行**
  - [ ] 全JSONローダー統合
  - [ ] zodバリデーション強化

#### 優先度: 低
- **アトラス盤**
- **クラフトシステム**
- **分岐職（Ascendancy相当）**
- **Web Worker分離（演算/描画）**

## 📝 技術的な決定事項

### なぜReact？
- コンポーネント単位の開発が容易
- 状態管理が明確
- UIの更新が効率的（React.memo等で最適化可能）

### なぜSVG？（PixiJSではなく）
- 初期実装の簡素化
- 十分なパフォーマンス（60fps維持可能）
- デバッグしやすい（DOM要素として確認可能）
- 将来的にPixiJSへの移行は可能

### デバッグ用調整
```javascript
// 経験値5倍
newPlayer.experience += exp * 5

// 必要経験値削減
newPlayer.experienceToNext = Math.floor(50 + newPlayer.level * 20)

// パッシブポイント2倍
newPlayer.passivePoints += 2

// 自動攻撃（0.5秒ごと）
if (currentTime - state.player.lastAttackTime > 500) {
  state = handleClick(state)
}
```

## 🐛 既知の問題/TODO

### バグ
- [ ] 敵が重なって見えにくい場合がある
- [ ] パッシブツリーのリンク表示が時々更新されない

### 改善点
- [ ] ダメージ数値のポップアップ表示
- [ ] エフェクトの追加（攻撃、レベルアップ等）
- [ ] 音声の実装
- [ ] レスポンシブ対応（モバイル）

## 📊 パフォーマンス目標

- **FPS**: 60fps維持（最低50fps）
- **メモリ**: 8時間放置でリークなし
- **セーブ**: 破損なし、1秒以内に完了
- **TTK基準**: 
  - 雑魚: 1-3秒
  - 精鋭: 10-20秒
  - ボス: 60-120秒（T1）

## 🎯 次のマイルストーン

### v0.1 (現在)
- ✅ 基本戦闘
- ✅ レベルシステム
- ✅ パッシブツリー
- ✅ ルーンシステム

### v0.2 (次回)
- [ ] 基本QoL実装
- [ ] 保存システム
- [ ] 通貨/アイテムシステム
- [ ] 初期バランス調整

### v0.3
- [ ] マップシステム
- [ ] ボス実装
- [ ] アトラス盤基礎

### v1.0
- [ ] 全システム統合
- [ ] 100時間プレイ可能なコンテンツ
- [ ] 最終バランス調整

## 💡 設計思想メモ

### コアコンセプト
- **「遊ぶほど楽になる」**: QoLは段階的解放、一度解放したら戻さない
- **「組む楽しさ」**: ビルドの多様性、死にビルドを作らない
- **「自分の経済を作る」**: エンドゲームはドロップ経済の構築

### データ駆動設計
- ゲームバランスはJSON編集で調整可能
- ハードコーディングを避ける
- コンテンツ追加が容易

### 命名規則（法務対策）
- Keystone → コーナーストーン
- Ascendancy → 分岐職
- Skill/Support Gem → ルーン/リンク

## 📚 参考リンク

- [README.md](./README.md) - ゲーム仕様書
- [src/content/](./src/content/) - ゲームデータJSON
- [GitHub Pages](https://t0iki.github.io/vibe-coding-workspace/) - デプロイ先

## 🛠️ 開発コマンド

```bash
# 開発サーバー起動
npm run dev

# ビルド
npm run build

# 型チェック
npm run typecheck

# フォーマット
npm run format
```

## 📅 更新履歴

### 2024/08/17
- Reactでフルリライト
- ルーン/リンクシステム実装
- パッシブツリー拡張（40ノード）
- デバッグ用自動攻撃追加
- レベルアップ速度調整

---

最終更新: 2024/08/17 by Claude